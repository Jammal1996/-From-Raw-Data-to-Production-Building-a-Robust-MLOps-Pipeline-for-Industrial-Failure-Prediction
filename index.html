<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Failure Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container mt-5 mb-5">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-9">
                <div class="card p-4">
                    <h3 class="text-center mb-2">Predictive Maintenance API</h3>
                    <p class="text-center text-muted mb-4">Enter sensor data to predict machine failure status</p>

                    <div class="row" id="featureInputs">
                        <!-- Inputs generated by JavaScript -->
                    </div>

                    <div class="mt-4">
                        <button onclick="makePrediction()" class="btn btn-primary w-100 py-3">Analyze Machine Status</button>
                    </div>

                    <div id="result" class="mt-4 text-center fw-bold"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const featuresInfo = [
            { id: "footfall", name: "Footfall", desc: "Number of people/objects passing by" },
            { id: "tempMode", name: "TempMode", desc: "Temperature mode or setting" },
            { id: "AQ", name: "AQ", desc: "Air Quality Index near machine" },
            { id: "USS", name: "USS", desc: "Ultrasonic Sensor (Proximity)" },
            { id: "CS", name: "CS", desc: "Current Sensor (Electrical usage)" },
            { id: "VOC", name: "VOC", desc: "Volatile Organic Compounds level" },
            { id: "RP", name: "RP", desc: "Rotational Position / RPM" },
            { id: "IP", name: "IP", desc: "Input Pressure" },
            { id: "Temperature", name: "Temperature", desc: "Operating Temperature" }
        ];

        function generateFeatureInputs() {
            const container = document.getElementById('featureInputs');
            featuresInfo.forEach((f) => {
                const col = document.createElement('div');
                col.className = 'col-md-6 mb-3';
                col.innerHTML = `
                    <label class="form-label small fw-bold text-uppercase mb-0">${f.name}</label>
                    <div class="text-muted small mb-1" style="font-size: 0.75rem;">${f.desc}</div>
                    <input type="number" step="any" class="form-control feature-input" 
                           id="input_${f.id}" placeholder="Enter value">
                `;
                container.appendChild(col);
            });
        }

        async function makePrediction() {
            const inputs = document.querySelectorAll('.feature-input');
            const features = Array.from(inputs).map(input => parseFloat(input.value));
            const display = document.getElementById('result');

            if (features.some(isNaN)) {
                display.className = "mt-4 alert alert-warning";
                display.innerText = "Please fill in all 9 fields with valid numbers.";
                return;
            }

            display.className = "mt-4 text-muted";
            display.innerText = "Processing...";

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ features: features })
                });

                const result = await response.json();

                if(result.status === 'success') {
                    const isFail = result.prediction === "Fail";
                    display.className = isFail ? "mt-4 alert alert-danger" : "mt-4 alert alert-success";
                    display.innerHTML = `<h5>Machine Status</h5><span class="display-6">${result.prediction}</span>`;
                } else {
                    display.className = "mt-4 alert alert-danger";
                    display.innerText = "Error: " + result.message;
                }
            } catch (e) {
                display.className = "mt-4 alert alert-danger";
                display.innerText = "Connection Error: Could not reach the API.";
            }
        }

        document.addEventListener('DOMContentLoaded', generateFeatureInputs);
    </script>
</body>
</html>
